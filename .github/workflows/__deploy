  deploy:
    runs-on: ubuntu-latest
    needs: build_and_push_to_docker_hub
    steps:
      - name: executing remote ssh commands to deploy
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USER }}
          key: ${{ secrets.SSH_KEY }}
          passphrase: ${{ secrets.PASSPHRASE }}
          script: |
            sudo docker pull ${{ secrets.DOCKER_USERNAME }}/mspp
            sudo docker-compose stop
#           sudo docker-compose rm backend_local
#           sudo rm .env_mspp

            touch .env_mspp
            echo DATABASE_URL=${{ secrets.DATABASE_URL }} >> .env_mspp
            echo POSTGRES_PASSWORD=${{ secrets.POSTGRES_PASSWORD }} >> .env_mspp
            echo SECRET=${{ secrets.SECRET }} >> .env_mspp
            echo FIRST_SUPERUSER_EMAIL=${{ secrets.FIRST_SUPERUSER_EMAIL }} >> .env_mspp
            echo FIRST_SUPERUSER_PASSWORD=${{ secrets.FIRST_SUPERUSER_PASSWORD }} >> .env_mspp
            echo TYPE=${{ secrets.TYPE }} >> .env_mspp
            echo PROJECT_ID=${{ secrets.PROJECT_ID }} >> .env_mspp
            echo PRIVATE_KEY_ID=${{ secrets.PRIVATE_KEY_ID }} >> .env_mspp
            echo PRIVATE_KEY=${{ secrets.PRIVATE_KEY }} >> .env_mspp
            echo CLIENT_EMAIL=${{ secrets.CLIENT_EMAIL }} >> .env_mspp
            echo CLIENT_ID=${{ secrets.CLIENT_ID }} >> .env_mspp
            echo AUTH_URI=${{ secrets.AUTH_URI }} >> .env_mspp
            echo TOKEN_URI=${{ secrets.TOKEN_URI }} >> .env_mspp
            echo AUTH_PROVIDER_X509_CERT_URL=${{ secrets.AUTH_PROVIDER_X509_CERT_URL }} >> .env_mspp
            echo CLIENT_X509_CERT_URL=${{ secrets.CLIENT_X509_CERT_URL }} >> .env_mspp
            echo EMAIL=${{ secrets.EMAIL }} >> .env_mspp

  #          sudo docker-compose -f docker-compose.qrkot_google.yaml up -d 
             sudo docker compose -f infra/docker-compose_local.yml up